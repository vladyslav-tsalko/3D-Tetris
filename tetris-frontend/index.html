<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>3D Tetris</title>

    <link rel="stylesheet" href="styles.css">
    <script type="text/javascript" src="src/game/gl-matrix-min.js"></script>   

    <script id="v-shader-nolight" type="x-shader/x-vertex">
        precision mediump float;

        attribute vec3 vertexPosition; 
        attribute vec3 vertexColor;   

        uniform mat4 modelViewMatrix;
        uniform mat4 projectionMatrix;

        varying vec3 fragmentColor;    

        void main() {
            gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0); 
            fragmentColor = vertexColor; 
        }
    </script>

    <script id="v-shader" type="x-shader/x-vertex">
        precision mediump float;

        attribute vec3 vertexPosition; 
        attribute vec3 vertexColor;    
        attribute vec3 vertexNormal;

        uniform mat4 modelViewMatrix;
        uniform mat4 projectionMatrix;
        uniform mat3 normalMatrix;

        uniform vec4 lightViewPosition;

        varying vec3 fragmentColor;

        void main() {
            // Transform vertex position to view space
            vec4 viewPosition = modelViewMatrix * vec4(vertexPosition, 1.0);

            // Calculate and normalize light vector
            vec3 lightVector = normalize(lightViewPosition.xyz - viewPosition.xyz);
            // Transform and normalize the normal
            vec3 transformedNormal = normalize(normalMatrix * vertexNormal);

            // Calculate light intensity
            // This can be negative, so just make negative values 0
            float lightIntensity = max(dot(lightVector, transformedNormal), 0.0);

            gl_Position = projectionMatrix * viewPosition; 
            // Multiply vertex color with lightIntensity
            fragmentColor = vertexColor * lightIntensity;
        }
    </script>

    <script id="f-shader" type="x-shader/x-fragment">
        precision mediump float;

        varying vec3 fragmentColor;

        void main() {
            gl_FragColor = vec4(fragmentColor, 1.0);
        }
    </script>
</head>

<body style="margin:0; padding:0; overflow:hidden;">
    <canvas id="background"></canvas>
    <canvas id="canvas"></canvas>

    
    <div id="userInfo" class="user-info">Guest</div>
    <div id="gameHUD">
        <div id="score">Score: 0</div>
        <div id="controls">
            <button id="restartButton" title="Restart">⟳</button>
            <button id="playPauseButton" title="Play/Pause">⏸</button>
            <button id="backButton">⌂</button>
        </div>
    </div>

    <div id="errorModal" class="error-popup">
        <div class="error-popup-content">
            <h2>Error</h2>
            <p id="errorMessage">Some error occurred</p>
            <button id="closeErrorBtn">OK</button>
        </div>
    </div>

    <div id="welcomeGuest">
        <h1>3D Tetris in Space</h1>

        <div class="button-row white-buttons">
            <button id="loginButton">Login</button>
            <button id="registerButton">Register</button>
        </div>

        <div class="button-row black-buttons">
            <button id="demoPlayButton">Demo Play</button>
            <button id="controlsButton">Controls</button>
        </div>
    </div>

    <div id="welcomeLogged" style="display: none;">
        <h1>3D Tetris in Space</h1>

        <div class="button-column black-buttons">
            <button id="playButton">Play</button>
            <button id="controlsButtonLogged">Controls</button>
            <button id="logoutButton">Logout</button>
        </div>


        <div id="topPlayersContainer" style="margin-top: 30px;">
            <h2>Top-10 Players</h2>
            <table id="topPlayersTable">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Nickname</th>
                        <th>Max Score</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modalScreen">
        <div class="modal-content">
            <h2>Register</h2>
            <div class="input-group">
                <input type="text" id="registerUsername" placeholder="Username">
                <div class="error-message" id="registerUsernameError"></div>
            </div>
            <div class="input-group">
                <input type="password" id="registerPassword" placeholder="Password">
                <div class="error-message" id="registerPasswordError"></div>
            </div>
             <div class="buttons">
                <button id="submitRegister">Register</button>
                <button id="closeRegister">Close</button>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modalScreen">
        <div class="modal-content">
            <h2>Login</h2>
            <div class="input-group">
                <input type="text" id="loginUsername" placeholder="Username">
                <div class="error-message" id="loginUsernameError"></div>
            </div>
            <div class="input-group">
                <input type="password" id="loginPassword" placeholder="Password">
                <div class="error-message" id="loginPasswordError"></div>
            </div>
            <div class="buttons">
                <button id="submitLogin">Login</button>
                <button id="closeLogin">Close</button>
            </div>
        </div>
    </div>


    <div id="controlsScreen" style="display: none;">
        <h2>3D Tetris Controls</h2>

        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Key</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>W / S</td><td>Move TetraCube forward/back</td></tr>
                    <tr><td>A / D</td><td>Move TetraCube left/right</td></tr>
                    <tr><td>Arrow Keys</td><td>Same as W/A/S/D</td></tr>
                    <tr><td>Space</td><td>Speed up falling</td></tr>
                    <tr><td>P</td><td>Pause / Unpause game</td></tr>
                    <tr><td>G</td><td>Toggle grid complexity</td></tr>
                    <tr><td>X / x</td><td>Rotate TetraCube around X axis (different directions)</td></tr>
                    <tr><td>Y / y</td><td>Rotate TetraCube around Y axis (different directions)</td></tr>
                    <tr><td>Z / z</td><td>Rotate TetraCube around Z axis (different directions)</td></tr>
                    <tr><td>+ / -</td><td>Zoom in / Zoom out</td></tr>
                    <tr><td>V</td><td>Change view (perspective/ortho)</td></tr>
                    <tr><td>Shift+V</td><td>Reset camera view</td></tr>
                    <tr><td>Mouse Scroll</td><td>Zoom camera in/out</td></tr>
                </tbody>
            </table>
        </div>

        <button id="closeControlsBtn">Close</button>
    </div>


    <script type="module" src="src/main.js"></script>
</body>

</html>